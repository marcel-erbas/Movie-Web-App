{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <a href="{{ url_for('home') }}" class="btn-secondary">‚Üê Back to Profiles</a>
    <h2>My Favorites Movies</h2>
    <div class="header-add-movie">
        <form action="{{ url_for('user_movies', user_id=user_id) }}" method="POST" style="display: flex; gap: 5px;">
            <input type="text" name="title" placeholder="New Movie..." required class="header-input">
            <button type="submit" class="btn-header">Add</button>
        </form>
    </div>
</div>

<!-- Movie List -->
<div class="movie-grid">
    {% if movies %}
    {% for movie in movies %}
    <div class="movie-card">
        <img src="{{ movie.poster_url }}" alt="{{ movie.title }} Poster" class="movie-poster">
        <div class="movie-info">
            <h3>{{ movie.title }} ({{ movie.year }})</h3>
            <p><strong>Director:</strong> {{ movie.director }}</p>

            <div class="movie-actions">
                <!-- Update Form -->
                <form action="{{ url_for('update_movie', user_id=user_id, movie_id=movie.id) }}" method="POST"
                    class="update-form" id="update-form-{{ movie.id }}">
                    <input type="hidden" name="new_title" value="{{ movie.title }}" id="title-input-{{ movie.id }}">
                    <button type="button" class="btn-small" data-id="{{ movie.id }}" data-title="{{ movie.title }}"
                        onclick="updateMovieTitle(this)">Update</button>
                </form>

                <!-- Delete Form -->
                <form action="{{ url_for('delete_movie', user_id=user_id, movie_id=movie.id) }}" method="POST"
                    class="delete-form" onsubmit="return confirm('Are you sure you want to delete this movie?');">
                    <button type="submit" class="btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p>No movies found. Add some above!</p>
    {% endif %}
</div>

<script>
    function updateMovieTitle(button) {
        const movieId = button.getAttribute('data-id');
        const currentTitle = button.getAttribute('data-title');

        const newTitle = prompt("Enter new title:", currentTitle);
        if (newTitle) {
            document.getElementById('title-input-' + movieId).value = newTitle;
            document.getElementById('update-form-' + movieId).submit();
        }
    }
</script>
{% endblock %}